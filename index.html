<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>National Voter Portal | Bangladesh</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Hind Siliguri', 'sans-serif'],
                        num: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            50: '#f0f9ff',
                            100: '#e0f2fe',
                            500: '#0ea5e9', // Sky Blue
                            600: '#0284c7',
                            700: '#0369a1',
                            900: '#0c4a6e', // Deep Navy
                        }
                    },
                    boxShadow: {
                        'soft': '0 10px 40px -10px rgba(0,0,0,0.08)',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f3f4f6;
            background-image: radial-gradient(#e5e7eb 1px, transparent 1px);
            background-size: 24px 24px;
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        .input-group:focus-within i { color: #0284c7; }
        .input-group:focus-within { border-color: #0284c7; ring: 2px solid #e0f2fe; }
        
        /* Smooth Fade In */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="text-slate-800 min-h-screen flex flex-col items-center py-8 px-4">

    <div class="text-center mb-8 fade-in">
        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-brand-100 text-brand-700 mb-4 shadow-sm">
            <i class="ph-fill ph-check-fat text-3xl"></i>
        </div>
        <h1 class="text-4xl font-bold text-slate-800 tracking-tight">ভোটার তথ্য যাচাইকরণ</h1>
        <p class="text-slate-500 mt-2 font-medium">বাংলাদেশ নির্বাচন কমিশন ডাটাবেস অনুসন্ধান পোর্টাল</p>
    </div>

    <div class="glass-panel w-full max-w-5xl rounded-3xl shadow-soft p-6 md:p-10 fade-in" style="animation-delay: 0.1s;">
        
        <div class="mb-8">
            <div class="flex items-center gap-2 mb-4">
                <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold text-sm">১</div>
                <h2 class="text-xl font-bold text-slate-700">এলাকা নির্বাচন</h2>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-5">
                <div>
                    <label class="block text-sm font-semibold text-slate-600 mb-1.5 ml-1">প্রশাসনিক এলাকা</label>
                    <div class="input-group flex items-center bg-white border border-slate-200 rounded-xl px-3 py-3 transition shadow-sm">
                        <i class="ph ph-buildings text-xl text-slate-400 mr-3"></i>
                        <select id="mainCat" class="w-full bg-transparent outline-none text-slate-700 font-medium cursor-pointer" onchange="updateSubCat()">
                            <option value="">নির্বাচন করুন...</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-slate-600 mb-1.5 ml-1">ওয়ার্ড বা ইউনিয়ন</label>
                    <div class="input-group flex items-center bg-slate-50 border border-slate-200 rounded-xl px-3 py-3 transition shadow-sm">
                        <i class="ph ph-map-pin text-xl text-slate-400 mr-3"></i>
                        <select id="subCat" class="w-full bg-transparent outline-none text-slate-700 font-medium cursor-pointer disabled:text-slate-400" onchange="updateArea()" disabled>
                            <option value="">আগে এলাকা বাছুন</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-slate-600 mb-1.5 ml-1">ভোটার এলাকা (গ্রাম)</label>
                    <div class="input-group flex items-center bg-slate-50 border border-slate-200 rounded-xl px-3 py-3 transition shadow-sm">
                        <i class="ph ph-house-line text-xl text-slate-400 mr-3"></i>
                        <select id="areaName" class="w-full bg-transparent outline-none text-slate-700 font-medium cursor-pointer disabled:text-slate-400" disabled>
                            <option value="">আগে ওয়ার্ড বাছুন</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="w-full h-px bg-slate-100 mb-8"></div>

        <div class="mb-8">
            <div class="flex items-center gap-2 mb-4">
                <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600 font-bold text-sm">২</div>
                <h2 class="text-xl font-bold text-slate-700">ব্যক্তি শনাক্তকরণ</h2>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-12 gap-5">
                <div class="md:col-span-5">
                    <label class="block text-sm font-semibold text-slate-600 mb-1.5 ml-1">জন্ম তারিখ (বাংলা)</label>
                    <div class="grid grid-cols-3 gap-2">
                        <div class="input-group flex items-center bg-white border border-slate-200 rounded-xl px-2 py-3">
                            <select id="dobDay" class="w-full bg-transparent outline-none text-center font-num text-slate-700"><option>দিন</option></select>
                        </div>
                        <div class="input-group flex items-center bg-white border border-slate-200 rounded-xl px-2 py-3">
                            <select id="dobMonth" class="w-full bg-transparent outline-none text-center text-slate-700"><option>মাস</option></select>
                        </div>
                        <div class="input-group flex items-center bg-white border border-slate-200 rounded-xl px-2 py-3">
                            <select id="dobYear" class="w-full bg-transparent outline-none text-center font-num text-slate-700"><option>বছর</option></select>
                        </div>
                    </div>
                </div>

                <div class="md:col-span-3">
                    <label class="block text-sm font-semibold text-slate-600 mb-1.5 ml-1">লিঙ্গ <span class="text-rose-500">*</span></label>
                    <div class="input-group flex items-center bg-white border border-slate-200 rounded-xl px-3 py-3 shadow-sm">
                        <i class="ph ph-gender-intersex text-xl text-slate-400 mr-3"></i>
                        <select id="gender" class="w-full bg-transparent outline-none text-slate-700 font-medium cursor-pointer">
                            <option value="পুরুষ">পুরুষ</option>
                            <option value="মহিলা">মহিলা</option>
                            <option value="হিজড়া">হিজড়া</option>
                        </select>
                    </div>
                </div>

                <div class="md:col-span-4">
                    <label class="block text-sm font-semibold text-slate-600 mb-1.5 ml-1">নাম (ঐচ্ছিক)</label>
                    <div class="input-group flex items-center bg-white border border-slate-200 rounded-xl px-3 py-3 shadow-sm">
                        <i class="ph ph-user text-xl text-slate-400 mr-3"></i>
                        <input type="text" id="nameInput" class="w-full bg-transparent outline-none text-slate-700 placeholder-slate-400" placeholder="নামের অংশ লিখুন...">
                    </div>
                </div>
                
                <div class="md:col-span-12">
                    <label class="block text-sm font-semibold text-slate-600 mb-1.5 ml-1">পিতা বা মাতার নাম (ঐচ্ছিক)</label>
                    <div class="input-group flex items-center bg-white border border-slate-200 rounded-xl px-3 py-3 shadow-sm">
                        <i class="ph ph-users text-xl text-slate-400 mr-3"></i>
                        <input type="text" id="parentInput" class="w-full bg-transparent outline-none text-slate-700 placeholder-slate-400" placeholder="পিতা বা মাতার নামের অংশ...">
                    </div>
                </div>
            </div>
        </div>

        <button onclick="searchVoter()" id="searchBtn" class="w-full bg-brand-600 hover:bg-brand-700 text-white font-bold text-lg py-4 rounded-xl shadow-lg shadow-brand-500/30 transition-all transform hover:scale-[1.01] active:scale-[0.99] flex items-center justify-center gap-3">
            <i class="ph-bold ph-magnifying-glass text-2xl"></i>
            <span>তথ্য অনুসন্ধান করুন</span>
        </button>

        <div id="statusMsg" class="mt-6 text-center hidden p-4 rounded-xl bg-slate-100 border border-slate-200">
            <p class="text-slate-600 font-medium"></p>
        </div>

    </div>

    <div id="resultsList" class="w-full max-w-5xl mt-8 grid grid-cols-1 md:grid-cols-2 gap-4"></div>

    <div id="detailModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
        
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white w-full max-w-lg rounded-3xl shadow-2xl relative transform transition-all scale-100 overflow-hidden fade-in">
                
                <div class="bg-brand-50 p-6 border-b border-brand-100 flex justify-between items-start">
                    <div>
                        <h3 id="modalTitle" class="text-2xl font-bold text-brand-900"></h3>
                        <div class="flex items-center gap-2 mt-1 text-brand-600 text-sm font-medium">
                            <i class="ph-fill ph-check-circle"></i>
                            <span>ভেরিফাইড ভোটার</span>
                        </div>
                    </div>
                    <button onclick="closeModal()" class="w-8 h-8 rounded-full bg-white hover:bg-red-50 text-slate-400 hover:text-red-500 flex items-center justify-center transition shadow-sm">
                        <i class="ph-bold ph-x"></i>
                    </button>
                </div>

                <div id="modalBody" class="p-6 space-y-3">
                    </div>

                <div class="p-6 pt-2 bg-white">
                    <button onclick="closeModal()" class="w-full bg-slate-100 hover:bg-slate-200 text-slate-700 font-bold py-3.5 rounded-xl transition">
                        বন্ধ করুন
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data & Logic (No Change in Logic, only connecting to new UI)
        const LOCATION_DATA = {
            "চট্টগ্রাম সিটি কর্পোরেশন": {
                "ওয়ার্ড নং-০৩ (বায়জিদ বোস্তামী)": ["ওয়াজেদিয়া", "নাথপুর", "ভোলাগঞ্জ", "হরিপুর", "নেজামেহামজা", "মিয়ানগর", "ঘাটঘর", "পূর্ব শহীদনগর", "পশ্চিম শহীদনগর", "ছালেহনগর", "আমিননগর", "হাজীরপুল", "হামিদপুর", "খোন্দকারাবাদ", "হাজীপাড়া", "উত্তর মুরাদনগর", "দক্ষিণ মুরাদনগর", "ফকিরাবাদ", "ভক্তপুর", "পাঠানপুর", "ককসুনগর", "সোনাপুর", "করিমগঞ্জ", "জানআলী নগর", "নজীরাবাদ", "মীরপুর", "কামরাবাদ", "সামাদপুর", "জাহানপুর"],
                "ওয়ার্ড নং-০৪ (চাঁদগাও)": ["অদুর পাড়া", "উত্তর চান্দগাঁও বেপারী পাড়া", "উত্তর চান্দগাঁও চৌধুরী পাড়া", "উত্তর চান্দগাঁও চৌধুরী পাড়া শিল্প এলাকা", "উত্তর চান্দগাঁও বড়ুয়া পাড়া", "ওয়াপদা কলোনী", "কোদালকাটা", "চান্দগাঁও আবাসিক এলাকা", "চান্দগাঁও আবাসিক এলাকা ব্লক-এ", "ডালি পাড়া", "খলিফাপাড়া ও দক্ষিণ চান্দগাঁও", "দক্ষিণ পশ্চিম চান্দগাঁও শহীদ পাড়া", "নাথ পাড়া", "নূরুল হক কন্ট্রাকটর বাড়ী", "পাঠানিয়া গোদা", "ফরিদের পাড়া", "মাইজ পাড়া", "মৌলভী পাড়া", "শমসের পাড়া", "হামিদ চর", "হায়দার আলী নজীর বাড়ী ও জালাল খান", "উত্তর চান্দগাঁও হিন্দু পাড়া"],
                "ওয়ার্ড নং-০৫ (চাঁদগাও)": ["চর মোহরা সি ব্লক", "চর রাঙ্গামাটিয়া", "মোহরা এ ব্লক", "মোহরা বি ব্লক", "মোহরা সি জে এম সি এল কলোনী"],
                "ওয়ার্ড নং-০৬ (চাঁদগাও)": ["কে,বি,আমান আলী রোড ব্লক-১", "কে,বি,আমান আলী রোড ব্লক-২", "কে,বি,আমান আলী রোড ব্লক-৩", "কে,বি,আমান আলী রোড ব্লক-৪", "পূর্ব ষোলশহর ব্লক-এ", "পূর্ব ষোলশহর ব্লক-বি", "পূর্ব ষোলশহর ব্লক-সি"],
                "ওয়ার্ড নং-০৭ (পাঁচলাইশ)": ["আমিন অফিসার্স কলোনী", "আমিন লেবার কলোনী", "আতুরার ডিপো", "আলী নগর", "খতিবের হাট", "নাজির পাড়া", "মোমেন বাগ", "বার্মা কলোনী", "বিবির হাট", "মোহাম্মদ নগর", "মোহাম্মদ পুর", "রৌফাবাদ কলোনী", "শান্তি নগর", "হামজার খাঁ লেইন", "হামজার দিঘীর পাড়", "হামজার বাগ", "হামজার বাগ কলোনী", "হিলভিউ", "বন গবেষণাগার"]
            },
            "বোয়ালখালী পৌরসভা": {
                "ওয়ার্ড নং-০১": ["পশ্চিম খিতাবচর (অংশ)", "কধুরখীল (অংশ)"],
                "ওয়ার্ড নং-০২": ["কধুরখীল (পাঠান পাড়া অংশ)", "পূর্ব গোমদন্ডী (২ নং ওয়ার্ড অংশ)"],
                "ওয়ার্ড নং-০৩": ["পূর্ব গোমদন্ডী (৩ নং ওয়ার্ড অংশ-১)", "পূর্ব গোমদন্ডী (৩ নং ওয়ার্ড অংশ-২)"],
                "ওয়ার্ড নং-০৪": ["পূর্ব গোমদন্ডী (৪ নং ওয়ার্ড অংশ-১)", "পূর্ব গোমদন্ডী (৪ নং ওয়ার্ড অংশ-২)"],
                "ওয়ার্ড নং-০৫": ["পূর্ব গোমদন্ডী (৫ নং ওয়ার্ড অংশ-১)", "পূর্ব গোমদন্ডী (৫ নং ওয়ার্ড অংশ-২)"],
                "ওয়ার্ড নং-০৬": ["পূর্ব গোমদন্ডী (৬ নং ওয়ার্ড অংশ-১)", "পূর্ব গোমদন্ডী (৬ নং ওয়ার্ড অংশ-২)"],
                "ওয়ার্ড নং-০৭": ["পশ্চিম গোমদন্ডী (৭ নং ওয়ার্ড অংশ-১)", "পশ্চিম গোমদন্ডী (৭ নং ওয়ার্ড অংশ-২)"],
                "ওয়ার্ড নং-০৮": ["পশ্চিম গোমদন্ডী (৮ নং ওয়ার্ড অংশ-১)", "পশ্চিম গোমদন্ডী (৮ নং ওয়ার্ড অংশ-২)"],
                "ওয়ার্ড নং-০৯": ["পশ্চিম গোমদন্ডী (৯ নং ওয়ার্ড অংশ-১)", "পশ্চিম গোমদন্ডী (৯ নং ওয়ার্ড অংশ-২)"]
            },
            "ইউনিয়ন পরিষদ (বোয়ালখালী)": {
                "কধুরখীল ইউনিয়ন": ["কধুরখীল (অংশ) ১ নং ওয়ার্ড", "কধুরখীল (অংশ) ২ নং ওয়ার্ড", "কধুরখীল (অংশ) ৩ নং ওয়ার্ড", "কধুরখীল (অংশ) ৪ নং ওয়ার্ড", "কধুরখীল (অংশ) ৫ নং ওয়ার্ড", "কধুরখীল (অংশ) ৬ নং ওয়ার্ড", "কধুরখীল (অংশ) ৭ নং ওয়ার্ড", "কধুরখীল (অংশ) ৮ নং ওয়ার্ড", "কধুরখীল (অংশ) ৯ নং ওয়ার্ড"],
                "পশ্চিম গোমদন্ডী ইউনিয়ন": ["চরখিজিরপুর", "চরখিজিরপুর (পূর্ব)", "দক্ষিন চরখিজিরপুর"],
                "শাকপুরা ইউনিয়ন": ["পশ্চিম শাকপুরা (উত্তর পশ্চিমাংশ)", "পশ্চিম শাকপুরা (২ নং ওয়ার্ড অংশ)", "পশ্চিম শাকপুরা (দক্ষিণাংশ)", "পশ্চিম শাকপুরা (৪ নং ওয়ার্ড অংশ)", "মধ্যম শাকপুরা (৫ নং ওয়ার্ড অংশ)", "মধ্যম শাকপুরা (৬ নং ওয়ার্ড অংশ)", "মধ্যম শাকপুরা (উত্তরাংশ)", "পূর্ব শাকপুরা", "ঘোষখীল (মধ্যম শাকপুরা পূর্বাংশ)"],
                "সারোয়াতলী ইউনিয়ন": ["পূর্ব সরোয়াতলী ও ছনদন্ডী (পূর্বাংশ)", "পশ্চিম সরোয়াতলী ছনদন্ডী (পশ্চিমাংশ)", "বেংগুরা", "হোরারবাগ", "পশ্চিম খিতাবচর", "পূর্ব খিতাবচর", "ইমামুল্লারচর", "দক্ষিণ সারোয়াতলী", "উত্তর সারোয়াতলী"],
                "পোপাদিয়া ইউনিয়ন": ["সৈয়দপুর", "উত্তর আকুবদন্ডী", "দক্ষিণ আকুবদন্ডী", "পোপাদিয়া (দক্ষিণাংশ)", "পোপাদিয়া (উত্তরাংশ)", "পোপাদিয়া (অংশ) (পশ্চিমাংশ)", "আকালিয়", "পোপাদিয়া", "বিদুগ্রাম (পশ্চিমাংশ)", "বিদুগ্রাম (পূর্বাংশ)"],
                "চরনদ্বীপ ইউনিয়ন": ["চরনদ্বীপ (১ নং ওয়ার্ড অংশ)", "পশ্চিম চরনদ্বীপ", "পাঠানপাড়া (৩ নং ওয়ার্ড অংশ)", "বারৈপাড়া (৪ নং ওয়ার্ড অংশ)", "বারৈপাড়া (৫ নং ওয়ার্ড অংশ)", "বারৈপাড়া (৬ নং ওয়ার্ড অংশ)", "চরনদ্বীপ (৭ নং ওয়ার্ড অংশ)", "চরনদ্বীপ (৮ নং ওয়ার্ড অংশ)", "পূর্ব চরনদ্বীপ"],
                "শ্রীপুর-খরনদ্বীপ ইউনিয়ন": ["পশ্চিম খরনদ্বীপ", "খরনদ্বীপ মাধ্যম", "খরনদ্বীপ", "শ্রীপুর (৪ নং ওয়ার্ড অংশ)", "শ্রীপুর (৫ নং ওয়ার্ড অংশ)", "শ্রীপুর (৬ নং ওয়ার্ড অংশ)", "জৈষ্ট্যপুরা (৭ নং ওয়ার্ড অংশ)", "জৈষ্ট্যপুরা (৮ নং ওয়ার্ড অংশ)", "জৈষ্ট্যপুরা (৯ নং ওয়ার্ড অংশ)"],
                "আমুচিয়া ইউনিয়ন": ["কানুনগোপাড়া", "কানুনগোপাড়া/বগাচড়া", "আমুচিয়া", "ধোরলা (৪ নং ওয়ার্ড অংশ)", "ধোরলা (৫ নং ওয়ার্ড অংশ)", "পূর্ব ধোরলা/কানুনগোপাড়া", "ধোরলা (৭ নং ওয়ার্ড অংশ)", "ধোরলা (৮ নং ওয়ার্ড অংশ)", "পূর্ব ধোরলা"],
                "আহল্লা করলডেংগা ইউনিয়ন": ["উত্তর করলডেংগা", "মধ্যম করলডেংগা", "দক্ষিণ করলডেংগা", "দক্ষিণ উত্তর ভূর্ষি", "উত্তর ভূর্ষি (৫ নং ওয়ার্ড অংশ)", "উত্তর ভূর্ষি (৬ নং ওয়ার্ড অংশ)", "আহল্লা সাধারপাড়া", "আহল্লা শেখ চৌধুরী পাড়া", "আহল্লা শেখ চৌধুরী পাড়া (দক্ষিন)"]
            }
        };
        const MONTH_MAP = {"জানুয়ারি": "০১", "ফেব্রুয়ারি": "০২", "মার্চ": "০৩", "এপ্রিল": "০৪", "মে": "০৫", "জুন": "০৬", "জুলাই": "০৭", "আগস্ট": "০৮", "সেপ্টেম্বর": "০৯", "অক্টোবর": "১০", "নভেম্বর": "১১", "ডিসেম্বর": "১২"};
        const toBn = n => n.toString().replace(/\d/g, d => "০১২৩৪৫৬৭৮৯"[d]);

        // Init Dropdowns
        window.addEventListener('load', () => {
            const mainSel = document.getElementById('mainCat');
            const dSel = document.getElementById('dobDay');
            const mSel = document.getElementById('dobMonth');
            const ySel = document.getElementById('dobYear');
            
            Object.keys(LOCATION_DATA).forEach(k => mainSel.add(new Option(k, k)));
            for(let i=1; i<=31; i++) dSel.add(new Option(toBn(i), toBn(i)));
            Object.keys(MONTH_MAP).forEach(k => mSel.add(new Option(k, k)));
            for(let i=2008; i>=1900; i--) ySel.add(new Option(toBn(i), toBn(i)));
        });

        // UI Helpers
        function setDisabled(id, disabled) {
            const el = document.getElementById(id);
            el.disabled = disabled;
            // Visual style change for disabled state
            const parent = el.parentElement;
            if(disabled) {
                parent.classList.add('bg-slate-50', 'border-slate-200');
                parent.classList.remove('bg-white', 'border-slate-300');
            } else {
                parent.classList.remove('bg-slate-50', 'border-slate-200');
                parent.classList.add('bg-white');
            }
        }

        function updateSubCat() {
            const main = document.getElementById('mainCat').value;
            const sub = document.getElementById('subCat');
            const area = document.getElementById('areaName');
            
            sub.innerHTML = '<option value="">নির্বাচন করুন...</option>';
            area.innerHTML = '<option value="">আগে ওয়ার্ড বাছুন</option>';
            
            setDisabled('subCat', !main);
            setDisabled('areaName', true);

            if(main) {
                Object.keys(LOCATION_DATA[main]).forEach(k => sub.add(new Option(k, k)));
            }
        }

        function updateArea() {
            const main = document.getElementById('mainCat').value;
            const subVal = document.getElementById('subCat').value;
            const area = document.getElementById('areaName');
            
            area.innerHTML = '<option value="">নির্বাচন করুন...</option>';
            
            if(!subVal) {
                setDisabled('areaName', true);
                return;
            }
            
            setDisabled('areaName', false);
            LOCATION_DATA[main][subVal].forEach(k => area.add(new Option(k, k)));
        }

        // ==========================================
        // KEY ZONE (PASTE HERE)
        // ==========================================
        const SUPABASE_URL = "https://qwztesrwzjpwephkwqye.supabase.co"; 
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF3enRlc3J3empwd2VwaGt3cXllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzODIwNjMsImV4cCI6MjA4NTk1ODA2M30.SdV0Z2x2RhEnrH9MkcMpQLZJ8irnHBXVaUJOJyql15Y";
        // ==========================================

        async function searchVoter() {
            const btn = document.getElementById('searchBtn');
            const statusDiv = document.getElementById('statusMsg');
            const statusText = statusDiv.querySelector('p');
            const list = document.getElementById('resultsList');
            
            // Loading State
            btn.disabled = true;
            btn.innerHTML = '<i class="ph ph-spinner animate-spin text-2xl"></i><span>অনুসন্ধান চলছে...</span>';
            statusDiv.classList.add('hidden');
            list.innerHTML = "";

            try {
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                
                const main = document.getElementById('mainCat').value;
                const sub = document.getElementById('subCat').value;
                const area = document.getElementById('areaName').value;
                const gender = document.getElementById('gender').value;
                const name = document.getElementById('nameInput').value.trim();
                const parent = document.getElementById('parentInput').value.trim();
                
                const d = document.getElementById('dobDay').value;
                const m = document.getElementById('dobMonth').value;
                const y = document.getElementById('dobYear').value;

                let dobQ = null;
                if(d!="দিন" && m!="মাস" && y!="বছর") {
                    dobQ = (d.length==1?"০"+d:d) + "/" + MONTH_MAP[m] + "/" + y;
                }

                let isValid = false;
                let err = "";

                if(!main) err = "দয়া করে প্রশাসনিক এলাকা নির্বাচন করুন";
                else if(sub === "") {
                    if(dobQ && name) isValid = true;
                    else err = "পুরো এলাকায় খুঁজতে হলে জন্ম তারিখ এবং নাম দুটিই বাধ্যতামূলক";
                } else if(area === "") {
                    if(dobQ || name || parent) isValid = true;
                    else err = "পুরো ওয়ার্ডে খুঁজতে হলে অন্তত নাম, পিতা/মাতা বা জন্ম তারিখ দিন";
                } else isValid = true;

                if(!isValid && !err) err = "তথ্য দিন";
                if(err) throw new Error(err);

                let q = supabase.from('Voter').select('*');
                
                if(area && area !== "") q = q.eq('voter_area_name', area);
                else if(sub && sub !== "") q = q.in('voter_area_name', LOCATION_DATA[main][sub]);

                q = q.eq('gender', gender);
                if(dobQ) q = q.ilike('dob', `%${dobQ}%`);
                if(name) q = q.ilike('name', `%${name}%`);
                if(parent) q = q.or(`father.ilike.%${parent}%,mother.ilike.%${parent}%`);

                const { data, error } = await q.limit(100);
                if(error) throw error;

                if(!data.length) {
                    statusDiv.className = "mt-6 text-center p-4 rounded-xl bg-red-50 border border-red-100 block fade-in";
                    statusText.className = "text-red-600 font-medium";
                    statusText.innerHTML = `<i class="ph-bold ph-warning-circle text-lg mr-1"></i> কোনো ভোটার পাওয়া যায়নি`;
                } else {
                    statusDiv.className = "mt-6 text-center p-4 rounded-xl bg-green-50 border border-green-100 block fade-in";
                    statusText.className = "text-green-600 font-medium";
                    statusText.innerHTML = `<i class="ph-bold ph-check-circle text-lg mr-1"></i> ${data.length} জন ভোটার পাওয়া গেছে`;
                    
                    // Generate Cards
                    data.forEach((v, index) => {
                        const card = document.createElement('div');
                        card.className = "bg-white p-5 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-all flex items-center justify-between group fade-in";
                        card.style.animationDelay = `${index * 0.05}s`; // Staggered animation
                        
                        card.innerHTML = `
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-full bg-slate-50 flex items-center justify-center text-slate-400 group-hover:bg-brand-50 group-hover:text-brand-600 transition">
                                    <i class="ph-fill ph-user text-2xl"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-800 text-lg leading-tight">${v.name}</h4>
                                    <p class="text-sm text-slate-500 font-num mt-1">পিতা: ${v.father}</p>
                                </div>
                            </div>
                            <button onclick='openModal(${JSON.stringify(v)})' class="w-10 h-10 rounded-full border border-slate-200 flex items-center justify-center text-slate-400 hover:bg-brand-600 hover:border-brand-600 hover:text-white transition">
                                <i class="ph-bold ph-caret-right text-xl"></i>
                            </button>
                        `;
                        list.appendChild(card);
                    });
                }

            } catch(e) {
                statusDiv.className = "mt-6 text-center p-4 rounded-xl bg-red-50 border border-red-100 block fade-in";
                statusText.className = "text-red-600 font-medium";
                statusText.innerHTML = `সমস্যা: ${e.message}`;
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="ph-bold ph-magnifying-glass text-2xl"></i><span>তথ্য অনুসন্ধান করুন</span>';
            }
        }

        function openModal(voter) {
            document.getElementById('modalTitle').innerText = voter.name;
            const body = document.getElementById('modalBody');
            
            const fields = [
                { label: "পিতা", val: voter.father, icon: "user" },
                { label: "মাতা", val: voter.mother, icon: "users" },
                { label: "ভোটার নং", val: voter.voter_no, icon: "identification-card", font: "font-num" },
                { label: "জন্ম তারিখ", val: voter.dob, icon: "calendar", font: "font-num" },
                { label: "পেশা", val: voter.profession, icon: "briefcase" },
                { label: "ঠিকানা", val: voter.address, icon: "map-pin" },
                { label: "এলাকা", val: voter.voter_area_name, icon: "buildings" },
                { label: "ভোটকেন্দ্র", val: voter.polling_center, icon: "house" }
            ];

            let html = "";
            fields.forEach(f => {
                html += `
                <div class="flex items-center justify-between p-3 bg-slate-50 rounded-xl border border-slate-100">
                    <div class="flex items-center gap-3 text-slate-500">
                        <i class="ph-fill ph-${f.icon} text-lg"></i>
                        <span class="font-medium text-sm">${f.label}</span>
                    </div>
                    <span class="font-semibold text-slate-800 ${f.font || ''}">${f.val || '-'}</span>
                </div>`;
            });

            body.innerHTML = html;
            document.getElementById('detailModal').classList.remove('hidden');
        }

        function closeModal() {
            document.getElementById('detailModal').classList.add('hidden');
        }
    </script>
</body>
</html>
