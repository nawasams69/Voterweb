<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ডা. মোঃ আবু নাছের | চট্টগ্রাম-৮ আসন</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@300;400;500;600;700&family=Tiro+Bangla:ital@0;1&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Hind Siliguri', 'sans-serif'],
                        serif: ['Tiro Bangla', 'serif'],
                    },
                    colors: {
                        party: {
                            green: '#006A4E', // জামায়াতের পতাকার গাঢ় সবুজ
                            dark: '#004d38',
                            red: '#D32F2F',   // লাল রঙ
                            light: '#E8F5E9'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #f0fdf4; background-image: radial-gradient(#006a4e 0.5px, transparent 0.5px); background-size: 20px 20px; }
        .glass-panel { background: rgba(255, 255, 255, 0.95); border: 1px solid #bbf7d0; box-shadow: 0 10px 40px -10px rgba(0, 106, 78, 0.2); backdrop-filter: blur(10px); }
        .input-group:focus-within { border-color: #006A4E; ring: 2px solid #a7f3d0; }
        .input-group:focus-within i { color: #006A4E; }
        
        /* হিরো সেকশন শ্যাডো */
        .hero-text-shadow { text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        
        /* এনিমেশন */
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .slide-up { animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes pulse-red { 0% { box-shadow: 0 0 0 0 rgba(211, 47, 47, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(211, 47, 47, 0); } 100% { box-shadow: 0 0 0 0 rgba(211, 47, 47, 0); } }
        .vote-anim { animation: pulse-red 2s infinite; }
    </style>
</head>
<body class="text-slate-800 min-h-screen relative overflow-x-hidden">

    <div class="absolute top-4 left-4 z-30 w-16 h-16 md:w-20 md:h-20 rounded-full border-4 border-white shadow-lg overflow-hidden bg-white">
        <img src="candidate_round.webp" alt="Logo" class="w-full h-full object-cover">
    </div>

    <header class="relative w-full bg-gradient-to-b from-party-green to-party-dark text-white pt-24 pb-16 px-4 rounded-b-[50px] shadow-2xl z-10 overflow-visible">
        
        <div class="absolute top-0 right-0 w-64 h-64 bg-white opacity-5 rounded-full -translate-y-1/2 translate-x-1/2"></div>
        
        <div class="max-w-5xl mx-auto flex flex-col md:flex-row items-center justify-between relative">
            
            <div class="text-center md:text-left z-20 md:w-3/5 mb-6 md:mb-0">
                <span class="bg-red-600 text-white px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-sm border border-red-400">চট্টগ্রাম-৮ আসন</span>
                
                <h1 class="text-4xl md:text-6xl font-bold font-serif mt-3 mb-2 hero-text-shadow leading-tight">
                    ডা. মোঃ আবু নাছের
                </h1>
                <p class="text-emerald-100 text-lg md:text-xl font-medium mb-6">
                    বাংলাদেশ জামায়াতে ইসলামী মনোনীত প্রার্থী
                </p>

                <div class="flex items-center justify-center md:justify-start gap-4 bg-white/10 backdrop-blur-md p-3 rounded-2xl border border-white/20 inline-flex">
                    <div class="bg-white p-1 rounded-full shadow w-16 h-16 flex items-center justify-center">
                        <img src="symbol.png" alt="দাঁড়িপাল্লা" class="w-full h-full object-contain">
                    </div>
                    <div class="text-left pr-4">
                        <p class="text-sm text-emerald-100">মার্কা</p>
                        <h2 class="text-2xl font-bold text-yellow-400 drop-shadow">দাঁড়িপাল্লা</h2>
                    </div>
                </div>
            </div>

            <div class="z-20 mt-4 md:-mt-20 md:absolute md:right-0 md:bottom-[-64px] w-64 md:w-80 transition-transform hover:scale-105 duration-500">
                <img src="candidate_face.png" alt="Candidate" class="w-full drop-shadow-2xl filter brightness-110">
            </div>
        </div>
    </header>

    <div class="relative z-20 -mt-8 px-4 pb-12 w-full max-w-4xl mx-auto">
        
        <div class="glass-panel rounded-3xl p-6 md:p-8 slide-up">
            <div class="text-center mb-6">
                <h3 class="text-xl font-bold text-party-green">ভোটার তথ্য যাচাই ও কেন্দ্র অনুসন্ধান</h3>
                <div class="h-1 w-16 bg-party-red mx-auto mt-2 rounded-full"></div>
            </div>

            <div class="mb-6 bg-green-50/60 p-4 rounded-xl border border-green-100">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <div>
                        <label class="text-xs font-bold text-gray-500 ml-1">প্রশাসনিক এলাকা</label>
                        <div class="input-group flex items-center bg-white border border-gray-300 rounded-lg px-2 py-2 mt-1">
                            <i class="ph ph-buildings text-lg text-gray-400 mr-2"></i>
                            <select id="mainCat" class="w-full bg-transparent outline-none text-sm font-semibold text-gray-700 cursor-pointer" onchange="updateSubCat()">
                                <option value="">নির্বাচন করুন...</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 ml-1">ওয়ার্ড / ইউনিয়ন</label>
                        <div class="input-group flex items-center bg-gray-50 border border-gray-200 rounded-lg px-2 py-2 mt-1">
                            <i class="ph ph-map-pin text-lg text-gray-400 mr-2"></i>
                            <select id="subCat" class="w-full bg-transparent outline-none text-sm font-semibold text-gray-700 cursor-pointer disabled:text-gray-400" onchange="updateArea()" disabled>
                                <option value="">আগে এলাকা বাছুন</option>
                            </select>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 ml-1">গ্রাম / মহল্লা</label>
                        <div class="input-group flex items-center bg-gray-50 border border-gray-200 rounded-lg px-2 py-2 mt-1">
                            <i class="ph ph-house-line text-lg text-gray-400 mr-2"></i>
                            <select id="areaName" class="w-full bg-transparent outline-none text-sm font-semibold text-gray-700 cursor-pointer disabled:text-gray-400" disabled>
                                <option value="">আগে ওয়ার্ড বাছুন</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-12 gap-4 mb-6">
                <div class="md:col-span-5">
                    <label class="text-xs font-bold text-gray-500 ml-1">জন্ম তারিখ</label>
                    <div class="grid grid-cols-3 gap-2 mt-1">
                        <select id="dobDay" class="bg-white border border-gray-300 rounded-lg py-2 text-center text-sm font-bold outline-none focus:border-party-green"><option>দিন</option></select>
                        <select id="dobMonth" class="bg-white border border-gray-300 rounded-lg py-2 text-center text-xs font-bold outline-none focus:border-party-green"><option>মাস</option></select>
                        <select id="dobYear" class="bg-white border border-gray-300 rounded-lg py-2 text-center text-sm font-bold outline-none focus:border-party-green"><option>বছর</option></select>
                    </div>
                </div>
                <div class="md:col-span-3">
                    <label class="text-xs font-bold text-gray-500 ml-1">লিঙ্গ <span class="text-red-500">*</span></label>
                    <div class="input-group flex items-center bg-white border border-gray-300 rounded-lg px-2 py-2 mt-1">
                        <i class="ph ph-gender-intersex text-lg text-gray-400 mr-2"></i>
                        <select id="gender" class="w-full bg-transparent outline-none text-sm font-bold text-gray-700">
                            <option value="পুরুষ">পুরুষ</option>
                            <option value="মহিলা">মহিলা</option>
                            <option value="হিজড়া">হিজড়া</option>
                        </select>
                    </div>
                </div>
                <div class="md:col-span-4">
                    <label class="text-xs font-bold text-gray-500 ml-1">নাম (ঐচ্ছিক)</label>
                    <div class="input-group flex items-center bg-white border border-gray-300 rounded-lg px-2 py-2 mt-1">
                        <input type="text" id="nameInput" class="w-full bg-transparent outline-none text-sm font-semibold text-gray-700 placeholder-gray-400" placeholder="নামের অংশ...">
                    </div>
                </div>
                <div class="md:col-span-12">
                    <label class="text-xs font-bold text-gray-500 ml-1">পিতা বা মাতার নাম (ঐচ্ছিক)</label>
                    <div class="input-group flex items-center bg-white border border-gray-300 rounded-lg px-2 py-2 mt-1">
                        <input type="text" id="parentInput" class="w-full bg-transparent outline-none text-sm font-semibold text-gray-700 placeholder-gray-400" placeholder="পিতা বা মাতার নাম...">
                    </div>
                </div>
            </div>

            <button onclick="searchVoter()" id="searchBtn" class="w-full bg-party-red hover:bg-red-700 text-white font-bold text-lg py-3.5 rounded-xl shadow-lg shadow-red-500/30 transition-transform active:scale-95 flex items-center justify-center gap-2 vote-anim border-b-4 border-red-800">
                <i class="ph-bold ph-magnifying-glass text-xl"></i>
                <span>অনুসন্ধান করুন</span>
            </button>

            <div id="statusMsg" class="mt-4 text-center hidden p-3 rounded-lg bg-gray-50 border border-gray-200 text-sm font-medium"></div>
        </div>

        <div id="resultsList" class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6"></div>

        <div class="mt-10 text-center">
            <p class="text-party-green font-bold text-lg">দেশ গড়তে মার্কায় ভোট দিন</p>
            <div class="flex items-center justify-center gap-2 mt-2 opacity-70">
                <img src="symbol.png" class="w-6 h-6 grayscale opacity-50">
                <p class="text-xs">প্রচার সেল | ডা. মোঃ আবু নাছের</p>
            </div>
        </div>
    </div>

    <div id="detailModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-emerald-900/80 backdrop-blur-sm transition-opacity" onclick="closeModal()"></div>
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white w-full max-w-md rounded-2xl shadow-2xl relative transform transition-all scale-100 overflow-hidden slide-up border-4 border-party-green">
                
                <div class="bg-party-green p-5 border-b border-green-700 flex justify-between items-center text-white">
                    <div class="flex items-center gap-3">
                        <div class="bg-white p-1 rounded-full w-10 h-10 overflow-hidden">
                            <img src="candidate_round.webp" class="w-full h-full object-cover">
                        </div>
                        <div>
                            <h3 id="modalTitle" class="text-xl font-bold font-serif"></h3>
                            <p class="text-xs text-green-200">সঠিক ভোটার তথ্য</p>
                        </div>
                    </div>
                    <button onclick="closeModal()" class="text-white/80 hover:text-white text-2xl">&times;</button>
                </div>

                <div id="modalBody" class="p-5"></div>

                <div class="p-4 bg-gray-50 text-center border-t">
                    <button onclick="closeModal()" class="px-6 py-2 bg-gray-200 hover:bg-gray-300 rounded-lg text-sm font-bold text-gray-700">বন্ধ করুন</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // KEY ZONE (আপনার কী এখানে বসান)
        // ==========================================
        const SUPABASE_URL = "https://qwztesrwzjpwephkwqye.supabase.co"; 
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InF3enRlc3J3empwd2VwaGt3cXllIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAzODIwNjMsImV4cCI6MjA4NTk1ODA2M30.SdV0Z2x2RhEnrH9MkcMpQLZJ8irnHBXVaUJOJyql15Y";
        // ==========================================

        const LOCATION_DATA = {
            "চট্টগ্রাম সিটি কর্পোরেশন": {
                "ওয়ার্ড নং-০৩ (বায়জিদ বোস্তামী)": ["ওয়াজেদিয়া", "নাথপুর", "ভোলাগঞ্জ", "হরিপুর", "নেজামেহামজা", "মিয়ানগর", "ঘাটঘর", "পূর্ব শহীদনগর", "পশ্চিম শহীদনগর", "ছালেহনগর", "আমিননগর", "হাজীরপুল", "হামিদপুর", "খোন্দকারাবাদ", "হাজীপাড়া", "উত্তর মুরাদনগর", "দক্ষিণ মুরাদনগর", "ফকিরাবাদ", "ভক্তপুর", "পাঠানপুর", "ককসুনগর", "সোনাপুর", "করিমগঞ্জ", "জানআলী নগর", "নজীরাবাদ", "মীরপুর", "কামরাবাদ", "সামাদপুর", "জাহানপুর"],
                "ওয়ার্ড নং-০৪ (চাঁদগাও)": ["অদুর পাড়া", "উত্তর চান্দগাঁও বেপারী পাড়া", "উত্তর চান্দগাঁও চৌধুরী পাড়া", "উত্তর চান্দগাঁও চৌধুরী পাড়া শিল্প এলাকা", "উত্তর চান্দগাঁও বড়ুয়া পাড়া", "ওয়াপদা কলোনী", "কোদালকাটা", "চান্দগাঁও আবাসিক এলাকা", "চান্দগাঁও আবাসিক এলাকা ব্লক-এ", "ডালি পাড়া", "খলিফাপাড়া ও দক্ষিণ চান্দগাঁও", "দক্ষিণ পশ্চিম চান্দগাঁও শহীদ পাড়া", "নাথ পাড়া", "নূরুল হক কন্ট্রাকটর বাড়ী", "পাঠানিয়া গোদা", "ফরিদের পাড়া", "মাইজ পাড়া", "মৌলভী পাড়া", "শমসের পাড়া", "হামিদ চর", "হায়দার আলী নজীর বাড়ী ও জালাল খান", "উত্তর চান্দগাঁও হিন্দু পাড়া"],
                "ওয়ার্ড নং-০৫ (চাঁদগাও)": ["চর মোহরা সি ব্লক", "চর রাঙ্গামাটিয়া", "মোহরা এ ব্লক", "মোহরা বি ব্লক", "মোহরা সি জে এম সি এল কলোনী"],
                "ওয়ার্ড নং-০৬ (চাঁদগাও)": ["কে,বি,আমান আলী রোড ব্লক-১", "কে,বি,আমান আলী রোড ব্লক-২", "কে,বি,আমান আলী রোড ব্লক-৩", "কে,বি,আমান আলী রোড ব্লক-৪", "পূর্ব ষোলশহর ব্লক-এ", "পূর্ব ষোলশহর ব্লক-বি", "পূর্ব ষোলশহর ব্লক-সি"],
                "ওয়ার্ড নং-০৭ (পাঁচলাইশ)": ["আমিন অফিসার্স কলোনী", "আমিন লেবার কলোনী", "আতুরার ডিপো", "আলী নগর", "খতিবের হাট", "নাজির পাড়া", "মোমেন বাগ", "বার্মা কলোনী", "বিবির হাট", "মোহাম্মদ নগর", "মোহাম্মদ পুর", "রৌফাবাদ কলোনী", "শান্তি নগর", "হামজার খাঁ লেইন", "হামজার দিঘীর পাড়", "হামজার বাগ", "হামজার বাগ কলোনী", "হিলভিউ", "বন গবেষণাগার"]
            },
            "বোয়ালখালী পৌরসভা": {
                "ওয়ার্ড নং-০১": ["পশ্চিম খিতাবচর (অংশ)", "কধুরখীল (অংশ)"],
                "ওয়ার্ড নং-০২": ["কধুরখীল (পাঠান পাড়া অংশ)", "পূর্ব গোমদন্ডী (২ নং ওয়ার্ড অংশ)"],
                "ওয়ার্ড নং-০৩": ["পূর্ব গোমদন্ডী (৩ নং ওয়ার্ড অংশ-১)", "পূর্ব গোমদন্ডী (৩ নং ওয়ার্ড অংশ-২)"],
                "ওয়ার্ড নং-০৪": ["পূর্ব গোমদন্ডী (৪ নং ওয়ার্ড অংশ-১)", "পূর্ব গোমদন্ডী (৪ নং ওয়ার্ড অংশ-২)"],
                "ওয়ার্ড নং-০৫": ["পূর্ব গোমদন্ডী (৫ নং ওয়ার্ড অংশ-১)", "পূর্ব গোমদন্ডী (৫ নং ওয়ার্ড অংশ-২)"],
                "ওয়ার্ড নং-০৬": ["পূর্ব গোমদন্ডী (৬ নং ওয়ার্ড অংশ-১)", "পূর্ব গোমদন্ডী (৬ নং ওয়ার্ড অংশ-২)"],
                "ওয়ার্ড নং-০৭": ["পশ্চিম গোমদন্ডী (৭ নং ওয়ার্ড অংশ-১)", "পশ্চিম গোমদন্ডী (৭ নং ওয়ার্ড অংশ-২)"],
                "ওয়ার্ড নং-০৮": ["পশ্চিম গোমদন্ডী (৮ নং ওয়ার্ড অংশ-১)", "পশ্চিম গোমদন্ডী (৮ নং ওয়ার্ড অংশ-২)"],
                "ওয়ার্ড নং-০৯": ["পশ্চিম গোমদন্ডী (৯ নং ওয়ার্ড অংশ-১)", "পশ্চিম গোমদন্ডী (৯ নং ওয়ার্ড অংশ-২)"]
            },
            "ইউনিয়ন পরিষদ (বোয়ালখালী)": {
                "কধুরখীল ইউনিয়ন": ["কধুরখীল (অংশ) ১ নং ওয়ার্ড", "কধুরখীল (অংশ) ২ নং ওয়ার্ড", "কধুরখীল (অংশ) ৩ নং ওয়ার্ড", "কধুরখীল (অংশ) ৪ নং ওয়ার্ড", "কধুরখীল (অংশ) ৫ নং ওয়ার্ড", "কধুরখীল (অংশ) ৬ নং ওয়ার্ড", "কধুরখীল (অংশ) ৭ নং ওয়ার্ড", "কধুরখীল (অংশ) ৮ নং ওয়ার্ড", "কধুরখীল (অংশ) ৯ নং ওয়ার্ড"],
                "পশ্চিম গোমদন্ডী ইউনিয়ন": ["চরখিজিরপুর", "চরখিজিরপুর (পূর্ব)", "দক্ষিন চরখিজিরপুর"],
                "শাকপুরা ইউনিয়ন": ["পশ্চিম শাকপুরা (উত্তর পশ্চিমাংশ)", "পশ্চিম শাকপুরা (২ নং ওয়ার্ড অংশ)", "পশ্চিম শাকপুরা (দক্ষিণাংশ)", "পশ্চিম শাকপুরা (৪ নং ওয়ার্ড অংশ)", "মধ্যম শাকপুরা (৫ নং ওয়ার্ড অংশ)", "মধ্যম শাকপুরা (৬ নং ওয়ার্ড অংশ)", "মধ্যম শাকপুরা (উত্তরাংশ)", "পূর্ব শাকপুরা", "ঘোষখীল (মধ্যম শাকপুরা পূর্বাংশ)"],
                "সারোয়াতলী ইউনিয়ন": ["পূর্ব সরোয়াতলী ও ছনদন্ডী (পূর্বাংশ)", "পশ্চিম সরোয়াতলী ছনদন্ডী (পশ্চিমাংশ)", "বেংগুরা", "হোরারবাগ", "পশ্চিম খিতাবচর", "পূর্ব খিতাবচর", "ইমামুল্লারচর", "দক্ষিণ সারোয়াতলী", "উত্তর সারোয়াতলী"],
                "পোপাদিয়া ইউনিয়ন": ["সৈয়দপুর", "উত্তর আকুবদন্ডী", "দক্ষিণ আকুবদন্ডী", "পোপাদিয়া (দক্ষিণাংশ)", "পোপাদিয়া (উত্তরাংশ)", "পোপাদিয়া (অংশ) (পশ্চিমাংশ)", "আকালিয়", "পোপাদিয়া", "বিদুগ্রাম (পশ্চিমাংশ)", "বিদুগ্রাম (পূর্বাংশ)"],
                "চরনদ্বীপ ইউনিয়ন": ["চরনদ্বীপ (১ নং ওয়ার্ড অংশ)", "পশ্চিম চরনদ্বীপ", "পাঠানপাড়া (৩ নং ওয়ার্ড অংশ)", "বারৈপাড়া (৪ নং ওয়ার্ড অংশ)", "বারৈপাড়া (৫ নং ওয়ার্ড অংশ)", "বারৈপাড়া (৬ নং ওয়ার্ড অংশ)", "চরনদ্বীপ (৭ নং ওয়ার্ড অংশ)", "চরনদ্বীপ (৮ নং ওয়ার্ড অংশ)", "পূর্ব চরনদ্বীপ"],
                "শ্রীপুর-খরনদ্বীপ ইউনিয়ন": ["পশ্চিম খরনদ্বীপ", "খরনদ্বীপ মাধ্যম", "খরনদ্বীপ", "শ্রীপুর (৪ নং ওয়ার্ড অংশ)", "শ্রীপুর (৫ নং ওয়ার্ড অংশ)", "শ্রীপুর (৬ নং ওয়ার্ড অংশ)", "জৈষ্ট্যপুরা (৭ নং ওয়ার্ড অংশ)", "জৈষ্ট্যপুরা (৮ নং ওয়ার্ড অংশ)", "জৈষ্ট্যপুরা (৯ নং ওয়ার্ড অংশ)"],
                "আমুচিয়া ইউনিয়ন": ["কানুনগোপাড়া", "কানুনগোপাড়া/বগাচড়া", "আমুচিয়া", "ধোরলা (৪ নং ওয়ার্ড অংশ)", "ধোরলা (৫ নং ওয়ার্ড অংশ)", "পূর্ব ধোরলা/কানুনগোপাড়া", "ধোরলা (৭ নং ওয়ার্ড অংশ)", "ধোরলা (৮ নং ওয়ার্ড অংশ)", "পূর্ব ধোরলা"],
                "আহল্লা করলডেংগা ইউনিয়ন": ["উত্তর করলডেংগা", "মধ্যম করলডেংগা", "দক্ষিণ করলডেংগা", "দক্ষিণ উত্তর ভূর্ষি", "উত্তর ভূর্ষি (৫ নং ওয়ার্ড অংশ)", "উত্তর ভূর্ষি (৬ নং ওয়ার্ড অংশ)", "আহল্লা সাধারপাড়া", "আহল্লা শেখ চৌধুরী পাড়া", "আহল্লা শেখ চৌধুরী পাড়া (দক্ষিন)"]
            }
        };
        const MONTH_MAP = {"জানুয়ারি": "০১", "ফেব্রুয়ারি": "০২", "মার্চ": "০৩", "এপ্রিল": "০৪", "মে": "০৫", "জুন": "০৬", "জুলাই": "০৭", "আগস্ট": "০৮", "সেপ্টেম্বর": "০৯", "অক্টোবর": "১০", "নভেম্বর": "১১", "ডিসেম্বর": "১২"};
        const toBn = n => n.toString().replace(/\d/g, d => "০১২৩৪৫৬৭৮৯"[d]);

        window.addEventListener('load', () => {
            const mainSel = document.getElementById('mainCat');
            const dSel = document.getElementById('dobDay');
            const mSel = document.getElementById('dobMonth');
            const ySel = document.getElementById('dobYear');
            Object.keys(LOCATION_DATA).forEach(k => mainSel.add(new Option(k, k)));
            for(let i=1; i<=31; i++) dSel.add(new Option(toBn(i), toBn(i)));
            Object.keys(MONTH_MAP).forEach(k => mSel.add(new Option(k, k)));
            for(let i=2008; i>=1900; i--) ySel.add(new Option(toBn(i), toBn(i)));
        });

        function setDisabled(id, disabled) {
            const el = document.getElementById(id);
            el.disabled = disabled;
            const parent = el.parentElement;
            if(disabled) { parent.classList.add('bg-gray-50'); parent.classList.remove('bg-white'); } 
            else { parent.classList.remove('bg-gray-50'); parent.classList.add('bg-white'); }
        }

        function updateSubCat() {
            const main = document.getElementById('mainCat').value;
            const sub = document.getElementById('subCat');
            const area = document.getElementById('areaName');
            sub.innerHTML = '<option value="">নির্বাচন করুন...</option>';
            area.innerHTML = '<option value="">আগে ওয়ার্ড বাছুন</option>';
            setDisabled('subCat', !main);
            setDisabled('areaName', true);
            if(main) Object.keys(LOCATION_DATA[main]).forEach(k => sub.add(new Option(k, k)));
        }

        function updateArea() {
            const main = document.getElementById('mainCat').value;
            const subVal = document.getElementById('subCat').value;
            const area = document.getElementById('areaName');
            area.innerHTML = '<option value="">নির্বাচন করুন...</option>';
            if(!subVal) { setDisabled('areaName', true); return; }
            setDisabled('areaName', false);
            LOCATION_DATA[main][subVal].forEach(k => area.add(new Option(k, k)));
        }

        async function searchVoter() {
            const btn = document.getElementById('searchBtn');
            const statusDiv = document.getElementById('statusMsg');
            const list = document.getElementById('resultsList');
            
            btn.disabled = true;
            btn.innerHTML = '<i class="ph ph-spinner animate-spin text-xl"></i><span>খোঁজা হচ্ছে...</span>';
            btn.classList.remove('vote-anim');
            statusDiv.classList.add('hidden');
            list.innerHTML = "";

            try {
                const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
                const main = document.getElementById('mainCat').value;
                const sub = document.getElementById('subCat').value;
                const area = document.getElementById('areaName').value;
                const gender = document.getElementById('gender').value;
                const name = document.getElementById('nameInput').value.trim();
                const parent = document.getElementById('parentInput').value.trim();
                const d = document.getElementById('dobDay').value;
                const m = document.getElementById('dobMonth').value;
                const y = document.getElementById('dobYear').value;

                let dobQ = null;
                if(d!="দিন" && m!="মাস" && y!="বছর") dobQ = (d.length==1?"০"+d:d) + "/" + MONTH_MAP[m] + "/" + y;

                let isValid = false;
                let err = "";
                if(!main) err = "দয়া করে প্রশাসনিক এলাকা নির্বাচন করুন";
                else if(sub === "") { if(dobQ && name) isValid = true; else err = "পুরো এলাকায় খুঁজতে হলে জন্ম তারিখ এবং নাম দুটিই বাধ্যতামূলক"; }
                else if(area === "") { if(dobQ || name || parent) isValid = true; else err = "পুরো ওয়ার্ডে খুঁজতে হলে অন্তত নাম, পিতা/মাতা বা জন্ম তারিখ দিন"; }
                else isValid = true;

                if(!isValid && !err) err = "তথ্য দিন";
                if(err) throw new Error(err);

                let q = supabase.from('Voter').select('*');
                if(area && area !== "") q = q.eq('voter_area_name', area);
                else if(sub && sub !== "") q = q.in('voter_area_name', LOCATION_DATA[main][sub]);

                q = q.eq('gender', gender);
                if(dobQ) q = q.ilike('dob', `%${dobQ}%`);
                if(name) q = q.ilike('name', `%${name}%`);
                if(parent) q = q.or(`father.ilike.%${parent}%,mother.ilike.%${parent}%`);

                const { data, error } = await q.limit(100);
                if(error) throw error;

                if(!data.length) {
                    statusDiv.className = "mt-6 text-center p-4 rounded-xl bg-red-50 text-red-600 block slide-up";
                    statusDiv.innerHTML = `<i class="ph-bold ph-warning-circle text-lg mr-1"></i> কোনো ভোটার পাওয়া যায়নি`;
                } else {
                    statusDiv.className = "mt-6 text-center p-4 rounded-xl bg-green-50 text-party-green block slide-up";
                    statusDiv.innerHTML = `<i class="ph-bold ph-check-circle text-lg mr-1"></i> ${data.length} জন ভোটার পাওয়া গেছে`;
                    
                    data.forEach((v, index) => {
                        const card = document.createElement('div');
                        card.className = "bg-white p-4 rounded-xl border-l-4 border-party-green shadow hover:shadow-lg transition flex items-center justify-between cursor-pointer slide-up";
                        card.style.animationDelay = `${index * 0.05}s`;
                        card.onclick = () => openModal(v);
                        
                        card.innerHTML = `
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full bg-green-50 flex items-center justify-center text-party-green font-bold"><i class="ph-fill ph-user text-xl"></i></div>
                                <div><h4 class="font-bold text-gray-800">${v.name}</h4><p class="text-xs text-gray-500 mt-0.5">পিতা: ${v.father}</p></div>
                            </div>
                            <div class="w-8 h-8 rounded-full border flex items-center justify-center text-gray-400"><i class="ph-bold ph-caret-right"></i></div>
                        `;
                        list.appendChild(card);
                    });
                }

            } catch(e) {
                statusDiv.className = "mt-6 text-center p-4 rounded-xl bg-red-50 text-red-600 block slide-up";
                statusDiv.innerHTML = `সমস্যা: ${e.message}`;
            } finally {
                btn.disabled = false;
                btn.classList.add('vote-anim');
                btn.innerHTML = '<i class="ph-bold ph-magnifying-glass text-xl"></i><span>অনুসন্ধান করুন</span>';
            }
        }

        function openModal(voter) {
            document.getElementById('modalTitle').innerText = voter.name;
            const body = document.getElementById('modalBody');
            
            // হাইলাইটেড ভোটকেন্দ্র (Top Priority)
            let html = `
                <div class="bg-gradient-to-br from-green-50 to-emerald-50 p-4 rounded-xl border border-green-200 mb-4 text-center shadow-inner">
                    <div class="flex items-center justify-center gap-2 text-party-green mb-1">
                        <i class="ph-fill ph-house-line text-lg"></i>
                        <span class="text-xs font-bold uppercase tracking-widest">আপনার ভোটকেন্দ্র</span>
                    </div>
                    <div class="text-xl font-bold text-gray-900 leading-tight">
                        ${voter.polling_center || 'তথ্য নেই'}
                    </div>
                </div>
            `;

            const fields = [
                { label: "ভোটার নং", val: voter.voter_no, icon: "identification-card" },
                { label: "পিতা", val: voter.father, icon: "user" },
                { label: "মাতা", val: voter.mother, icon: "users" },
                { label: "জন্ম তারিখ", val: voter.dob, icon: "calendar" },
                { label: "পেশা", val: voter.profession, icon: "briefcase" },
                { label: "ঠিকানা", val: voter.address, icon: "map-pin" },
                { label: "এলাকা", val: voter.voter_area_name, icon: "buildings" },
            ];

            fields.forEach(f => {
                html += `
                <div class="flex items-center justify-between p-2.5 border-b border-gray-100 last:border-0 hover:bg-gray-50 transition rounded">
                    <div class="flex items-center gap-3 text-gray-500">
                        <i class="ph-fill ph-${f.icon} text-lg text-party-green opacity-70"></i>
                        <span class="font-medium text-sm">${f.label}</span>
                    </div>
                    <span class="font-bold text-gray-800 text-right text-sm">${f.val || '-'}</span>
                </div>`;
            });

            body.innerHTML = html;
            document.getElementById('detailModal').classList.remove('hidden');
        }

        function closeModal() { document.getElementById('detailModal').classList.add('hidden'); }
    </script>
</body>
</html>
